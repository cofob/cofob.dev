pipeline:
  install:
    image: node:18
    commands:
      - yarn
  lint:
    image: node:18
    commands:
      - yarn lint
      - yarn check
  build:
    image: node:18
    commands:
      - yarn build:static
  mk-car:
    image: cofob/ipfs-tools
    commands:
      - ipfs-car --wrapWithDirectory false --pack build/ --output build.car
  pin-web3:
    image: cofob/node-hugo-jq
    commands:
      - |
        curl -X 'POST' \
          'https://api.web3.storage/car' \
          -H 'accept: application/json' \
          -H "Authorization: Bearer $JWT" \
          -H 'Content-Type: application/vnd.ipld.car' \
          --data-binary '@build.car' | jq -r .cid > cid.txt
      - echo "https://$(cat cid.txt).ipfs.ipfsqr.ru/"
    secrets: [JWT]
